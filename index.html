<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PENGUMUMAN KELULUSAN SDN PANGKUR 1 TP. 2024/2025</title>
  <link rel="icon" href="nw.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
  <style>
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url('city-background.png') center center / cover no-repeat;
      opacity: 0.2;
      z-index: -1;
    }
  </style>
</head>
<body class="bg-blue-900 bg-opacity-90 text-white min-h-screen flex flex-col justify-between relative">
  <div class="p-4 sm:p-6 text-center">
    <img src="logo.png" alt="Logo" class="mx-auto w-20 mb-4" />
    <h1 class="text-2xl sm:text-3xl font-bold mb-2">
      PENGUMUMAN KELULUSAN SDN PANGKUR 1 TP. 2024/2025
    </h1>
    <div id="countdown" class="mb-4 text-lg font-semibold"></div>

    <!-- Form Login Siswa -->
    <div id="loginForm" class="bg-blue-800 bg-opacity-95 p-6 rounded-xl w-full max-w-sm mx-auto hidden shadow-lg">
      <h2 class="text-xl font-semibold mb-4">Login Siswa</h2>
      <input id="nisn" type="text" placeholder="NISN"
        class="w-full p-2 mb-2 rounded text-black focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <input id="tanggal" type="text" placeholder="Tanggal Lahir (DDMMYYYY)"
        class="w-full p-2 mb-4 rounded text-black focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <button onclick="loginSiswa()"
        class="bg-white text-blue-800 px-4 py-2 rounded w-full hover:bg-blue-200 transition">Login</button>
    </div>

    <!-- Hasil Kelulusan -->
    <div id="hasilKelulusan" class="hidden mt-6">
      <div id="statusKelulusan" class="text-xl font-bold mb-4"></div>
      <div id="nilaiSiswa" class="text-lg mb-2"></div>
      <div class="text-sm mb-1">Nilai ambang batas: 70</div>
      <div id="pesanKelulusan" class="text-md"></div>
      <button onclick="logoutSiswa()" class="mt-4 bg-red-600 px-4 py-2 rounded hover:bg-red-700 transition">Logout</button>
    </div>
  </div>

  <!-- Tombol kecil login admin -->
  <button onclick="openAdminLogin()" class="text-xs text-gray-300 absolute bottom-2 right-2 hover:underline">
    Login Admin
  </button>

  <!-- Popup login admin -->
  <div id="adminLoginPopup" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50">
    <div class="bg-blue-800 bg-opacity-95 p-6 rounded-xl w-full max-w-sm text-white relative shadow-xl">
      <button onclick="closeAdminLogin()" class="absolute top-2 right-2 text-white hover:text-red-400">âœ–</button>
      <h2 class="text-xl font-semibold mb-4">Login Admin</h2>
      <input id="adminUsername" type="text" placeholder="Username"
        class="w-full p-2 mb-2 rounded text-black focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <input id="adminPassword" type="password" placeholder="Password"
        class="w-full p-2 mb-4 rounded text-black focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <button onclick="loginAdmin()"
        class="bg-white text-blue-800 px-4 py-2 rounded w-full hover:bg-blue-200 transition">Login</button>
    </div>
  </div>

  <footer class="text-center p-4 text-sm bg-blue-800 mt-12">
    &copy; Dinas Pendidikan dan Kebudayaan Kabupaten Ngawi
  </footer>

  <script>
    // Konfigurasi Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyDHGXTBAkCyxxsFkkeYAJ2znwsYd4tqhVo",
      authDomain: "sdn-pangkur1.firebaseapp.com",
      databaseURL: "https://sdn-pangkur1-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "sdn-pangkur1",
      storageBucket: "sdn-pangkur1.appspot.com",
      messagingSenderId: "916172794638",
      appId: "1:916172794638:web:8c50e0df42cc75aaa9c55f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const ADMIN_CREDENTIALS = {
      username: "admin",
      password: "admin123"
    };

    const countdownEl = document.getElementById("countdown");
  const loginForm = document.getElementById("loginForm");

  // Ambil waktu akses dari Realtime Database
  db.ref("pengaturan/waktu_akses").once("value", snap => {
    if (snap.exists()) {
      const waktuAkses = new Date(snap.val()).getTime();
      mulaiCountdown(waktuAkses);
    } else {
      countdownEl.textContent = "Waktu akses belum diatur oleh admin.";
    }
  });

  function mulaiCountdown(batasAkses) {
    const interval = setInterval(() => {
      const sekarang = new Date().getTime();
      const selisih = batasAkses - sekarang;
      if (selisih <= 0) {
        clearInterval(interval);
        countdownEl.textContent = "Silakan login menggunakan NISN dan Tanggal Lahir";
        loginForm.classList.remove("hidden");
      } else {
        const jam = Math.floor(selisih / (1000 * 60 * 60));
        const menit = Math.floor((selisih % (1000 * 60 * 60)) / (1000 * 60));
        const detik = Math.floor((selisih % (1000 * 60)) / 1000);
        countdownEl.textContent = `Akses dibuka dalam ${jam}j ${menit}m ${detik}d`;
      }
    }, 1000);
  }

    function loginSiswa() {
      const nisn = document.getElementById("nisn").value;
      const tanggal = document.getElementById("tanggal").value;
      db.ref("siswa/" + nisn).once("value", snap => {
        if (snap.exists() && snap.val().tanggal_lahir === tanggal) {
          const data = snap.val();
          loginForm.classList.add("hidden");
          setTimeout(() => {
            document.getElementById("hasilKelulusan").classList.remove("hidden");
            document.getElementById("statusKelulusan").innerHTML = data.lulus
              ? '<div class="bg-green-600 p-6 rounded-xl shadow">SELAMAT ANDA DINYATAKAN LULUS</div>'
              : '<div class="bg-red-700 p-6 rounded-xl shadow">MAAF, ANDA DINYATAKAN TIDAK LULUS</div>';
            document.getElementById("nilaiSiswa").textContent = "Nilai Anda: " + data.nilai;
            document.getElementById("pesanKelulusan").textContent = data.lulus
              ? "Selamat dan sukses untuk jenjang selanjutnya!"
              : "Tetap semangat, masih ada banyak kesempatan untuk belajar!";
          }, 1500);
        } else {
          alert("Data tidak ditemukan atau salah!");
        }
      });
    }

    function logoutSiswa() {
      document.getElementById("hasilKelulusan").classList.add("hidden");
      loginForm.classList.remove("hidden");
      document.getElementById("nisn").value = "";
      document.getElementById("tanggal").value = "";
    }

    function openAdminLogin() {
      document.getElementById("adminLoginPopup").classList.remove("hidden");
    }

    function closeAdminLogin() {
      document.getElementById("adminLoginPopup").classList.add("hidden");
    }

    function loginAdmin() {
      const username = document.getElementById("adminUsername").value;
      const password = document.getElementById("adminPassword").value;

      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        localStorage.setItem("admin", true);
        window.location.href = "admin-dashboard.html";
      } else {
        alert("Username atau password salah");
      }
    }
  </script>
</body>
</html>
